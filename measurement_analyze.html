<head>
  <meta charset="utf-8">
  <script src="library/vue/vue.js"></script>
  <script src="library/d3/d3.v4.min.js"></script>
  <script src="library/jquery/jquery-3.2.0.min.js"></script>
  <script>
    // global namespace
    if(!window.UAESNameSpace){
      window.UAESNameSpace = {};
    }
    UAESNameSpace.a2lFiles = [];
    UAESNameSpace.hexFiles = [];
    UAESNameSpace.parseResults  = [];
    /*
      define resource
    */
    var resource = {
      bootstrap: [
        "library/bootstrap/bootstrap.css",
        "library/bootstrap/bootstrap.min.js"

      ],
      bootstrap_easyWizard: [
        "library/bootstrap/easyWizard/easyWizard.css",
        "library/bootstrap/easyWizard/easyWizard.js"
      ],
      jquery_fileinput: [
        "library/jquery/UIComponents/fileinput/jquery-filestyle.min.css",
        "library/jquery/UIComponents/fileinput/jquery-filestyle.min.js"
      ],
      jquery_ui: [
        "library/jquery/jquery-ui-1.12.1/jquery-ui.min.css",
        "library/jquery/jquery-ui-1.12.1/jquery-ui.min.js"
      ],
      jquery_select2: [
        "library/jquery/UIComponents/select2/select2.min.css",
        "library/jquery/UIComponents/select2/select2.min.js"
      ],
      dashboard: [
        "assets/dashboard.css"
      ],
      bootstrap_select: [
        "library/bootstrap/select/bootstrap-select.min.css",
        "library/bootstrap/select/bootstrap-select.min.js"
      ],
      ASAMFileParser: [
        "library/ASAM/fileParser.js"
      ],
      justForMe: [
        "assets/measurement_analyze.js"
      ]
      /*vue: [
        "library/vue/vue.js"
      ]
      */
    };

    var require = function(resource = {}){
      for (const n in resource){
        for ( const path of resource[n]){
          if (path.substr(path.length-3, 3) == ".js") {
            let js = document.createElement("script");
            js.src = path;
            js.defer = true;
            document.querySelector("head").appendChild(js);
          }
          else if (path.substr(path.length-4, 4) == ".css") {
            let css = document.createElement("link");
            css.rel = "stylesheet";
            css.href = path;
            document.querySelector("head").appendChild(css);
          }
        }
      }
    }

    require(resource);
  </script>
  <style>
    /* global*/
    div:focus{
      outline: none;
    }
    .css-d3-graph{
      position: relative;
    }
    .css-d3-graph .css-d3-line:hover{
      filter: url(#id-svg-filter-glow);
    }
    .css-d3-graph .css-d3-line:focus{
      filter: url(#id-svg-filter-glow);
    }
    /* legend table */
    .css-d3-legendTable{
      border: 1px solid #ddd;
      position: absolute;
      left: 0;
      top: 0;
    }

    .css-d3-legendTable-td{
      width: 36px;
      height: 20px;
      text-align: center;
      vertical-align: middle;
    }
    .css-d3-legend-svgBox, .css-d3-legend-svgBox rect{
      width: 24px;
      height: 12px;
    }

    .css-d3-graph{
      cursor: pointer;
    }
    .css-d3-graph:before{
      content: "before"
    }
    .css-d3-graph:after{
      content: "after"
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">检查机动队</a>
        <ul class="nav navbar-nav">
          <li><a id="id-btn-toolbar-create" href="#" onfocus="this.blur()" data-toggle="modal" data-target="#id-dialog-forToolbar">Create</a></li>
          <li><a id="id-btn-toolbar-save" href="#" onfocus="this.blur()">Save</a></li>
          <li><a id="id-btn-toolbar-data" href="#" onfocus="this.blur()" data-toggle="modal" data-target="#id-dialog-data">Data</a></li>

          <li>
            <a id="id-btn-toolbar-insert" href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Insert
            <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="id-btn-toolbar-insert">
              <li><a id="id-btn-insert-graph" href="#">Graph</a></li>
              <li><a id="id-btn-insert-cursor" href="#" data-toggle="modal" data-target="#id-dialog-addPlot">Plot</a></li>
              <li><a href="#">Table</a></li>
              <li><a href="#">Formula</a></li>
              <li><a href="#">Shape</a></li>
              <li><a href="#">Picture</a></li>
            </ul>
          </li>

          <li><a href="#">Imort</a></li>
          <li><a id="id-btn-cursorMode" href="#">Cursor</a></li>
        </ul>
      </div>
      <!--
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">Dashboard</a></li>
          <li><a href="#">Settings</a></li>
          <li><a href="#">Profile</a></li>
          <li><a href="#">Help</a></li>
        </ul>
        <form class="navbar-form navbar-right">
          <input type="text" class="form-control" placeholder="Search...">
        </form>
      </div>
      -->
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-md-2 sidebar">
        <ul class="nav nav-sidebar">
          <li class="active"><a href="#">Overview <span class="sr-only">(current)</span></a></li>
          <li><a href="#">Reports</a></li>
          <li><a href="#">Analytics</a></li>
          <li><a href="#">Export</a></li>
        </ul>
        <ul class="nav nav-sidebar">
          <li><a href="">Nav item</a></li>
          <li><a href="">Nav item again</a></li>
          <li><a href="">One more nav</a></li>
          <li><a href="">Another nav item</a></li>
          <li><a href="">More navigation</a></li>
        </ul>
        <ul class="nav nav-sidebar">
          <li><a href="">Nav item again</a></li>
          <li><a href="">One more nav</a></li>
          <li><a href="">Another nav item</a></li>
        </ul>
      </div>

      <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <!--
        <div class="page-header">
          <h3>Measurement Analyze Online</h3>
        </div>
      -->

        <!-- dialog for toolbar - create page -->
        <div id="id-dialog-forToolbar" class="modal fade" aria-hidden="true" data-backdrop="false">
          <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="cursor: move;">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title" id="myModalLabel">Create new graph</h4>
                </div>
                <div class="modal-body">
                  <form class="form-horizontal">
                    <!-- graph name-->
                    <div class="form-group">
                      <label class="col-md-3 control-label">Graph name:</label>
                      <div class="col-md-8">
                        <input type="text" class="form-control" id="id-input-graphName" placeholder="graph name" />
                      </div>
                    </div>
                    <!-- graph type -->
                    <div class="form-group">
                      <label class="col-md-3 control-label">Type - Config:</label>
                      <div class="col-md-4">
                        <select id="id-select-graphType" class="selectpicker" data-live-search="true" data-width="fit">
                          <option>折线图</option>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <select id="id-select-graphConfig" class="selectpicker" data-live-search="true" data-width="fit">
                        </select>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary">OK</button>
                </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal -->
        </div>

        <!-- dialog for toolbar - add plot -->
        <div id="id-dialog-addPlot" class="modal fade" aria-hidden="true" data-backdrop="false">
          <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="cursor: move;">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title" id="">Add new plot</h4>
                </div>
                <div class="modal-body">
                  <form class="form-horizontal">
                    <!-- graph name-->
                    <div class="form-group">
                      <label class="col-md-3 control-label">Graph name:</label>
                      <div class="col-md-8">
                        <input type="text" class="form-control" id="" placeholder="graph name" />
                      </div>
                    </div>
                    <!-- graph type -->
                    <div class="form-group">
                      <label class="col-md-3 control-label">Type - Config:</label>
                      <div class="col-md-4">
                        <select id="id-select-mdfFile" class="selectpicker" data-live-search="true" data-width="fit">
                          <option>dat file1</option>
                          <option>dat file2</option>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <select id="id-select-channel" class="selectpicker" data-live-search="true" data-width="fit">
                          <option>testChannel.d1</option>
                          <option>testChannel.d2</option>
                          <option>testChannel.d3</option>
                        </select>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary">OK</button>
                </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal -->
        </div>

        <!-- dialog for toolbar - data management -->
        <div id="id-dialog-data" class="modal fade" aria-hidden="true" data-backdrop="false">
          <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="cursor: move;">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title" id="">Data Management</h4>
                </div>
                <div class="modal-body">
                  <form class="form-horizontal">
                    <!-- import mdf-->
                    <div class="form-group">
                      <label class="col-md-3 control-label">Import DAT:</label>
                      <div class="col-md-8">
                        <input id="id-a2lFileInput" type="file" class="jfilestyle" data-placeholder="请添加一个DAT文件" data-inputSize="fit">
                      </div>
                    </div>

                    <!-- imported mdf list-->
                    <ul class="list-group" style="max-height:300px;overflow-y:scroll;">
                      <li class="list-group-item">1.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">2.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">3.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">1.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">2.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">3.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">1.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">2.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">3.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">1.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">2.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">3.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">1.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">2.dat<span class="badge">remove</span></li>
                      <li class="list-group-item">3.dat<span class="badge">remove</span></li>
                    </ul>

                    <!-- graph type -->
                    <div class="form-group">
                      <label class="col-md-3 control-label">Graph Used Channel:</label>
                      <div class="col-md-4">
                        <select id="id-select-mdfFile" class="selectpicker" data-live-search="true" data-width="fit">
                          <option>graph 1</option>
                          <option>graph 2</option>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <select id="id-select-channel" class="selectpicker" data-live-search="true" data-width="fit">
                          <option>testChannel.d1</option>
                          <option>testChannel.d2</option>
                          <option>testChannel.d3</option>
                        </select>
                      </div>
                    </div>
                  </form>

                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary">OK</button>
                </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal -->
        </div>

        <!-- body: painter area -->
        <div id="id-tabs-painter" class="row" style="top:36px;overflow-y:scroll;">
          <ul>
            <!--some li of tabs head-->
          </ul>
          <svg width="0" height="0">
            <defs>
              <filter id="id-svg-filter-glow" x="-2" y="-2" width="200" height="200">
                <feGaussianBlur stdDeviation="2.5" result="coloredBlur" />
                <feMerge>
                  <feMergeNode in="coloredBlur" />
                  <feMergeNode in="SourceGraphic" />
                </feMerge>
              </filter>
            </defs>
          </svg>
          <!--some div of tabs content-->
        </div>

      </div>
    </div>
  </div>
</body>

<!-- js running on this index page -->
<script>
  window.addEventListener("load", function(){
    //all modals are draggable
    $("div.modal").draggable({
      handle: ".modal-header"
    });


    // modal for create page
    $(function(){
      // bind cursor postion change event
      document.onselectionchange = function(){

      }

      // $ functions initialize
      var tabTitle = $( "#id-input-graphName" ),
          tabContent = $( "#tab_content" ),
          tabTemplate = "<li><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span></li>",
          tabCounter = 1;

      var tabs = $("#id-tabs-painter").tabs();

      tabs.on("click", "span.ui-icon-close", function(){
        var panelId = $( this ).closest( "li" ).remove().attr( "aria-controls" );
        $( "#" + panelId ).remove();
        tabs.tabs( "refresh" );
      });

      $("div #id-dialog-forToolbar .btn-primary").on("click", function(){
        addTab();
        $("#id-dialog-forToolbar").modal("hide");
      });

      // insert graph
      $("#id-btn-insert-graph").on("click", function(){
        var activePanelId = $("ul[role='tablist'] > li[aria-selected='true']").attr("aria-controls");
        d3.select("#" + activePanelId).goblinsD3Painter();
      })

      function addTab(graphName){
        //#id-input-graphName
        var label = tabTitle.val() || "graph " + tabCounter,
            id = "tabs-" + tabCounter,
            li = $( tabTemplate.replace( /#\{href\}/g, "#" + id ).replace( /#\{label\}/g, label ) ),
            tabContentHtml = tabContent.val() || "Page " + tabCounter + " Title";

        tabs.find( ".ui-tabs-nav" ).append( li );
        tabs.append( "<div id='" + id + "' contenteditable='true'><h3>" + tabContentHtml + "</h3></div>" );
        tabs.tabs( "refresh" );
        tabCounter++;

        // swtich to latest tab (import!)
        tabs.tabs("option", "active", -1);
      }

      // $ functions initialize end!
    });

    // modal for add plot
    $(function(){
      $("div #id-dialog-addPlot .btn-primary").on("click", function(){
        let data = eval($("#id-select-channel").val());
        d3.activeGraph.addPlot({data:data});
        $("#id-dialog-addPlot").modal("hide");
      });
    });

    //
    $(function(){

    });

    // initialize the painter area

    //d3.select("#id-tabs-1").goblinsD3Painter();

    //

  });

  // test1
  /*kkk = [1,2,3]

  var vue_checkResult_col1 = new Vue({
    el: "#id-checkResult-name",
    data: {
      list: UAESNameSpace.parseResults
    }
  });
  */

  // test1 end

  // test2: simulate data array for plot
  var testChannel = {
    d1: [{x:1, y:1}, {x:2, y:0}, {x:3, y:1}, {x:4, y:2}],
    d2: [{x:1, y:0.5}, {x:2, y:1}, {x:3, y:0.5}, {x:4, y:2}],
    d3: [{x:1, y:2}, {x:2, y:0.7}, {x:3, y:3.2}, {x:4, y:0.8}]
  }

  var temp2;
</script>
